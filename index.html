<!DOCTYPE html>
<html>
	<head>
		<title>Test</title>
    <meta content="text/html;charset=UTF-8" http-equiv="Content-Type"/>
	</head>
	<body>
		<script>
async function imageUrlToBase64(imageUrl) {
  try {
    const response = await fetch(imageUrl);
    const blob = await response.blob();
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
      reader.readAsDataURL(blob);
    });
  } catch (error) {
    console.error('Error fetching or converting image from URL:', error);
    throw error;
  }
}

// // Example usage:
// imageUrlToBase64(location.search.substring(1))
//   .then(base64Image => {
//     console.log(base64Image);
//   })
//   .catch(error => {
//     console.error('Operation failed:', error);
//   });

async function loadImage(url) {
  return new Promise(r => { let i = new Image(); i.onload = (() => r(i)); i.src = url; });
}

async function url2base64(url) {
  let img = await loadImage(url);
  // img.crossOrigin = 'anonymous';
  const myCanvas = document.createElement('canvas');
  document.body.appendChild(myCanvas);
  myCanvas.getContext('2d').drawImage(img, 0, 0);
  const base64Image = myCanvas.toDataURL('image/webp');
  console.log(base64Image);
}

url2base64(location.search.substring(1));
		</script>
	</body>
</html>